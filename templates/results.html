{% extends "base.html" %}

{% block content %}
        <h1>Voting Results</h1>

        <p class="subtitle">
            ðŸ—³ <strong>{{ total_votes }}</strong> of <strong>{{ max_votes }}</strong> have cast their vote
        </p>

        {% if total_votes == 0 %}
        <div class="alert alert-error">
            <strong>No votes yet</strong>
        </div>
        {% else %}
        <table class="results-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Destination</th>
                </tr>
            </thead>
            <tbody>
                {% if results %}
                <tr id="winner-row" onclick="revealWinner()" style="cursor: pointer;">
                    <td><strong id="winner-label" style="font-size: 24px; color: transparent;">Winner</strong></td>
                    <td style="position: relative;">
                        <span id="click-hint" style="color: #888; font-size: 18px; font-style: italic;">Click to reveal</span>
                        <strong id="winner-dest" style="font-size: 42px; color: transparent;">{{ results[0].destination }}</strong>
                        {% if results[0].by %}
                        <br><small id="winner-by" style="color: transparent; font-size: 24px;">by {{ results[0].by }}</small>
                        {% endif %}
                        <br><small id="winner-score" style="color: transparent; font-size: 14px;">Total points: <strong>{{ results[0].total_score }}</strong></small>
                    </td>
                </tr>
                <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
                <script>
                let isRevealed = false;
                function revealWinner() {
                    if (!isRevealed) {
                        document.getElementById('click-hint').style.display = 'none';
                        document.getElementById('winner-label').style.color = '#333';
                        document.getElementById('winner-dest').style.color = 'var(--terracotta)';
                        const byElement = document.getElementById('winner-by');
                        if (byElement) byElement.style.color = '#888';
                        document.getElementById('winner-score').style.color = '#666';

                        // Trigger confetti
                        confetti({
                            particleCount: 100,
                            spread: 70,
                            origin: { y: 0.6 }
                        });

                        isRevealed = true;
                    }
                }
                </script>
                {% endif %}
            </tbody>
        </table>


        {% endif %}
{% endblock %}
